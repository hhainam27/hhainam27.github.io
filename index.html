<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Random Manga Redirect</title>
  <style>
    body { background: #0f0f0f; color: #fff; font-family: sans-serif; text-align: center; padding-top: 20vh; }
    h1 { color: #f472b6; text-shadow: 0 0 10px #f472b6; }
  </style>
</head>
<body>
  <h1>🎲 Đang chọn manga ngẫu nhiên...</h1>
  <p>Nếu lâu, vui lòng nhấn nút bên dưới:</p>
  <button id="retryBtn" style="padding:1em 2em; font-size:1rem; cursor:pointer;">Chọn lại</button>

  <script>
    async function randomRedirect() {
      try {
        const proxy = "https://corsproxy.io/?url=";
        const apiUrl = encodeURIComponent("https://cuutruyen.net/api/v2/teams/1/mangas/recently_updated?page=1&per_page=50");
        const res = await fetch(proxy + apiUrl);
        const json = await res.json();
        if (!Array.isArray(json.data) || json.data.length === 0) throw new Error("No data");

        const random = json.data[Math.floor(Math.random() * json.data.length)];
        const url = `https://cuutruyen.net/mangas/${random.id}`;

        const a = document.createElement("a");
        a.href = url;
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        document.body.appendChild(a);
        a.click();
        a.remove();

        setTimeout(() => { window.location.href = url; }, 300);
      } catch (err) {
        console.error(err);
        document.getElementById("retryBtn").style.display = "inline-block";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("retryBtn").addEventListener("click", randomRedirect);
      randomRedirect();
    });
  </script>
</body>
</html>
