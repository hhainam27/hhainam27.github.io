<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Random Manga Redirect</title>
  <style>
    body {
      background: #0f0f0f;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      padding-top: 20vh;
    }
    h1 {
      color: #f472b6;
      text-shadow: 0 0 10px #f472b6;
    }
    button {
      padding: 1em 2em;
      font-size: 1rem;
      cursor: pointer;
      background-color: #f472b6;
      color: white;
      border: none;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(244,114,182,0.5);
    }
  </style>
</head>
<body>
  <h1>üé≤ ƒêang ch·ªçn manga ng·∫´u nhi√™n...</h1>
  <p>N·∫øu l√¢u, vui l√≤ng nh·∫•n n√∫t b√™n d∆∞·ªõi:</p>
  <button id="retryBtn" style="display:none;">Ch·ªçn l·∫°i</button>

    <script>
      function waitForElm(selector) {
        return new Promise((resolve) => {
          if (document.querySelector(selector)) {
            return resolve(document.querySelector(selector));
          }

          const observer = new MutationObserver((mutations) => {
            if (document.querySelector(selector)) {
              observer.disconnect();
              resolve(document.querySelector(selector));
            }
          });

          observer.observe(document.body, {
            childList: true,
            subtree: true,
          });
        });
      }

      waitForElm("body").then((randomBtn) => {
        let fetchedMangas = [];
        const perPage = 50;
        let currentPage = 1;
        let totalPages = null;
        let totalCount = 0;

        async function redirectRandomManga(page = 1) {
          const url = `https://cuutruyen.net/api/v2/teams/485/mangas/recently_updated?page=${page}&per_page=${perPage}`;

          try {
            const response = await fetch(url);
            if (!response.ok) throw new Error("HTTP error " + response.status);
            const json = await response.json();

            if (totalPages === null) {
              totalPages = json._metadata.total_pages;
              const randomPage = Math.floor(Math.random() * totalPages);
              await redirectRandomManga(currentPage);
            } else {
              fetchedMangas = json.data;
              const randomManga =
                fetchedMangas[Math.floor(Math.random() * fetchedMangas.length)];
              if (randomManga) {
                const mangaUrl = `https://cuutruyen.net/mangas/${randomManga.id}`;
                window.location.href = mangaUrl;
              }
            }
          } catch (err) {
            console.error("‚ùå Error fetching page:", err);
            document.body.innerHTML =
              '<h2 style="color: red; text-align: center;">Kh√¥ng th·ªÉ t·∫£i danh s√°ch manga</h2>;';
          }
        }
        redirectRandomManga();
      });
    </script>
</body>
</html>
